<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <!-- Android 状态栏透明 -->
    <meta name="theme-color" content="transparent" />
    <title>Chat App</title>

    <link rel="stylesheet" href="./assets/css/toastr.min.css" />
    <link rel="stylesheet" href="./assets/css/main.css" />
    <link rel="stylesheet" href="./assets/css/qq-legacy.css" />
    <link rel="stylesheet" href="./assets/css/cards.css" />
    <link rel="stylesheet" href="./assets/css/chat.css" />
    <link rel="stylesheet" href="./assets/css/legacy-card.css" />
    <link rel="stylesheet" href="./assets/css/contact-groups.css" />
  </head>
  <body class="bg-legacy">
    <div id="app">
      <section id="chat-page" class="page active">
        <!-- 消息界面顶部：头像+用户信息横向布局 -->
        <div id="message-topbar" class="topbar qq-message-topbar">
          <div class="user-info-section">
            <button id="avatar-button" class="user-avatar-btn">
              <img src="./assets/external/feather-default.png" alt="" />
            </button>
            <div class="user-info-text">
              <div class="user-nickname">用户</div>
              <div class="user-status">😊在线 ›</div>
            </div>
          </div>
          <button id="plus-button" class="icon-button">＋</button>
        </div>

        <!-- 聊天列表：头像+名字+预览+时间 -->
        <div id="chat-list" class="chat-list">
          <div class="chat-list-item" data-session="default">
            <img
              src="./assets/external/feather-default.png"
              alt=""
              class="chat-item-avatar"
            />
            <div class="chat-item-content">
              <div class="chat-item-header">
                <div class="chat-item-name">默认会话</div>
                <div class="chat-item-time">00:00</div>
              </div>
              <div class="chat-item-preview">点击进入聊天</div>
            </div>
          </div>
        </div>

        <!-- QQ 风格聊天室 - 使用原版结构 -->
        <div id="chat-room" class="QQ_chat_page hidden qq-scrollable">
          <!-- 聊天室顶部 - 返回 + 会话名 + 菜单 -->
          <div class="chat-room-topbar">
            <button id="back-to-list" class="chat-back-btn">‹</button>
            <div class="chat-room-title" id="current-chat-title">default</div>
            <button id="chat-menu-btn" class="chat-menu-btn">≡</button>
          </div>

          <!-- 消息列表区 -->
          <div id="chat-scroll" class="msgcontent qq-scrollable"></div>

          <!-- 输入区 - 原版样式 -->
          <div class="chat-input-container">
            <button class="voice-btn">+</button>
            <textarea id="composer-input" class="chat-input" placeholder="" rows="1"></textarea>
            <button id="send-button" class="chat-send-btn" aria-label="发送">
              <img src="./assets/external/send-icon.png" alt="" class="chat-send-icon" />
            </button>
          </div>
        </div>
      </section>

      <section id="contacts-page" class="page">
        <!-- 联系人顶部：与消息界面一致 -->
        <div class="topbar qq-message-topbar">
          <div class="user-info-section">
            <button class="user-avatar-btn">
              <img src="./assets/external/feather-default.png" alt="" />
            </button>
            <div class="user-info-text">
              <div class="user-nickname">用户</div>
              <div class="user-status">😊在线 ›</div>
            </div>
          </div>
          <button class="icon-button">＋</button>
        </div>

        <!-- 搜索框 -->
        <div class="search-box-wrapper">
          <div id="floating_search_box" class="search-box-wrapper-inner">
            <input type="text" id="contact_search_input" class="contact-search" placeholder="搜索联系人..." />
            <button
              id="search_clear_btn"
              class="search-clear-btn"
              type="button"
              aria-label="清除搜索"
              style="display: none"
            >
              ×
            </button>
          </div>
        </div>

        <!-- 联系人列表：分组显示 -->
        <div class="contacts-list">
          <!-- 群聊（不参与联系人分组） -->
          <div class="contact-group">
            <div class="contact-group-title">群聊</div>
            <div id="contacts-groups-list"></div>
          </div>

          <!-- 联系人 -->
          <div class="contact-group">
            <div class="contact-group-title">联系人</div>
            <div id="contacts-ungrouped-list"></div>
          </div>
        </div>
      </section>

      <section id="moments-page" class="page">
        <!-- 动态顶部：标题+图标 -->
        <div class="topbar moments-topbar">
          <div class="moments-title">动态</div>
          <div class="moments-actions">
            <button class="icon-button-small" id="moments-bell-btn">🔔</button>
            <button class="icon-button-small" id="moments-settings-btn">⚙</button>
          </div>
        </div>

        <!-- 动态卡片列表 -->
        <div class="moments-list" id="moments-list"></div>
      </section>

      <!-- Avatar settings menu -->
      <div id="settings-menu" class="sheet hidden settings-menu">
        <div class="sheet-header">⚙ 设置</div>
        <div class="sheet-desc">账户 / 会话</div>
        <button data-action="settings">⚙ 设定</button>
        <button data-action="persona">👤 用户角色</button>
        <button data-action="session">💬 会话</button>
        <button data-action="preset">🎛 预设</button>
        <button data-action="memory-templates">🧠 记忆表格</button>
        <button data-action="world-global">🌐 世界书</button>
        <button data-action="regex">🧩 正规表达式</button>
        <button data-action="config">🔌 API设定</button>
      </div>

      <!-- Chat room menu (top-right ≡) -->
      <div id="chatroom-menu" class="sheet hidden">
        <div class="sheet-header">会话快捷</div>
        <div class="sheet-desc">当前聊天相关操作</div>
        <button data-action="world">🌐 世界书</button>
        <button data-action="regex">🧩 正规表达式</button>
        <button data-action="vars">🧮 变量管理器</button>
        <button data-action="chat-settings">🎨 聊天设置</button>
        <button data-action="prompt-preview">🧩 本次 Prompt</button>
        <button data-action="raw-reply">🧾 原始回复</button>
      </div>

      <!-- Chat title menu (click title) -->
      <div id="chat-title-menu" class="sheet hidden">
        <div class="sheet-header">会话</div>
        <div class="sheet-desc">当前好友/群组设置</div>
        <button data-action="contact-settings">⚙ 设置</button>
      </div>

      <!-- Plus quick menu -->
      <div id="quick-menu" class="sheet hidden">
        <button data-action="add-friend">添加好友</button>
        <button data-action="create-group">创建群组</button>
        <button data-action="new-group">新建分组</button>
      </div>

      <!-- Chat settings modal -->
      <div id="chat-settings-overlay" class="popup-overlay" style="display: none"></div>
      <div id="chat-settings-modal" class="chat-setting-popup" style="display: none">
        <div class="chat-setting-header">
          <span>聊天设置</span>
          <span class="close-setting-btn" id="close-chat-settings">×</span>
        </div>
        <div class="chat-setting-content">
          <div class="setting-item">
            <span>气泡颜色</span>
            <input type="text" id="bubble-color-input" value="#c9c9c9" />
            <input type="color" id="bubble-color" class="color-picker" value="#c9c9c9" />
          </div>
          <div class="setting-item">
            <span>字体颜色</span>
            <input type="text" id="text-color-input" value="#1F2937" />
            <input type="color" id="text-color" class="color-picker" value="#1F2937" />
          </div>
          <div class="setting-item setting-scope">
            <span>应用范围</span>
            <div class="setting-scope-options">
              <label>
                <input type="radio" name="chat-setting-scope" value="current" checked />
                当前聊天
              </label>
              <label>
                <input type="radio" name="chat-setting-scope" value="all" />
                全部聊天
              </label>
            </div>
          </div>
          <div class="setting-item setting-wallpaper">
            <span>聊天壁纸</span>
            <div class="wallpaper-uploader">
              <input type="file" id="chat-wallpaper-file" accept="image/*,image/gif" />
              <div id="chat-wallpaper-drop" class="wallpaper-drop">
                <div class="wallpaper-drop-title">拖拽图片/GIF到这里</div>
                <div class="wallpaper-drop-desc">或点击选择文件</div>
                <div class="wallpaper-drop-meta">支持 JPG / PNG / WebP / GIF</div>
              </div>
              <div id="wallpaper-status" class="wallpaper-status">未设置壁纸</div>
              <div class="wallpaper-editor">
                <div id="wallpaper-preview" class="wallpaper-preview">
                  <img id="wallpaper-preview-image" alt="" />
                  <div class="wallpaper-preview-overlay">
                    <div class="wallpaper-preview-bubble">预览气泡</div>
                  </div>
                </div>
                <div class="wallpaper-controls">
                  <label>
                    缩放
                    <input type="range" id="wallpaper-zoom" min="0.6" max="2.5" step="0.01" value="1" />
                  </label>
                  <label>
                    旋转
                    <input type="range" id="wallpaper-rotate" min="-180" max="180" step="1" value="0" />
                  </label>
                  <div class="wallpaper-actions">
                    <button type="button" id="wallpaper-fit-btn">适配</button>
                    <button type="button" id="wallpaper-reset-btn">重置</button>
                    <button type="button" id="wallpaper-clear-btn">清除</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="setting-preview">
            <div id="chat-setting-preview" class="QQ_chat_msgdiv">
              <span>这是预览文本</span>
            </div>
          </div>
        </div>
        <div class="chat-setting-footer">
          <button id="random-setting-btn">随机</button>
          <button id="restore-setting-btn">恢复默认</button>
          <button id="save-setting-btn">保存</button>
          <button id="cancel-setting-btn">取消</button>
        </div>
      </div>

      <!-- Bottom nav -->
      <nav class="bottom-nav">
        <button class="nav-btn active" data-page="chat">聊天</button>
        <button class="nav-btn" data-page="contacts">联系人</button>
        <button class="nav-btn" data-page="moments">动态</button>
      </nav>
    </div>

    <script src="./lib/jquery.min.js"></script>
    <script src="./lib/toastr.min.js"></script>
    <script type="module" src="./scripts/ui/app.js"></script>
  </body>
</html>
